{"version":3,"sources":["neurosync-pubsub.js"],"names":["Neuro","live","get","url","cache","PubSub","LiveFactory","database","handlePublish","message","forceOffline","op","OP_SAVE","liveSave","key","model","OP_REMOVE","liveRemove","pubsub","channel","token","save","noop","remove","subscribe","debug","Debugs","PUBSUB_CREATED","onpublish","data","publish","$key"],"mappings":"AACAA,MAAAC,KAAA,WAOA,QAAAC,GAAAC,GAEA,MAAAA,KAAAC,GAAAA,EAAAD,GAAAC,EAAAD,GAAA,GAAAE,QAAAF,GAGA,QAAAG,GAAAC,GAeA,QAAAC,GAAAC,GAEAT,MAAAU,eAEAD,EAAAE,KAAAC,GAEAL,EAAAM,SAAAJ,EAAAK,IAAAL,EAAAM,OAEAN,EAAAE,KAAAK,GAEAT,EAAAU,WAAAR,EAAAK,MAvBA,IAAAP,EAAAW,SAAAX,EAAAY,UAAAZ,EAAAa,MAEA,OACAC,KAAArB,MAAAsB,KACAC,OAAAvB,MAAAsB,KAIA,IAAAJ,GAAAhB,EAAAK,EAAAW,QACAC,EAAAD,EAAAM,UAAAjB,EAAAY,QAAAZ,EAAAa,MAqBA,OAnBApB,OAAAyB,MAAAzB,MAAA0B,OAAAC,eAAAT,GAiBAC,EAAAS,UAAApB,GAIAW,QAAAA,EACAD,OAAAA,EAEAG,KAAA,SAAAN,EAAAc,GAEA7B,MAAAU,cAEAS,EAAAW,SAEAnB,GAAAC,EACAE,IAAAC,EAAAgB,OACAhB,MAAAc,KAKAN,OAAA,SAAAR,GAEAf,MAAAU,cAEAS,EAAAW,SAEAnB,GAAAK,EACAF,IAAAC,EAAAgB,WAnEA,GAAAnB,GAAA,EACAI,EAAA,EAEAZ,IAwEA,OAAAE","file":"neurosync-pubsub.min.js","sourcesContent":["\nNeuro.live = (function()\n{\n  var OP_SAVE = 1;\n  var OP_REMOVE = 2;\n\n  var cache = {};\n\n  function get(url)\n  {\n    return url in cache ? cache[ url ] : ( cache[ url ] = new PubSub( url ) );\n  }\n\n  function LiveFactory(database)\n  {\n    if ( !database.pubsub || !database.channel || !database.token )\n    {\n      return { \n        save: Neuro.noop, \n        remove: Neuro.noop \n      };\n    }\n\n    var pubsub = get( database.pubsub );\n    var channel = pubsub.subscribe( database.channel, database.token );\n\n    Neuro.debug( Neuro.Debugs.PUBSUB_CREATED, pubsub );\n\n    function handlePublish(message)\n    {\n      if ( !Neuro.forceOffline )\n      {\n        if ( message.op === OP_SAVE )\n        {\n          database.liveSave( message.key, message.model );\n        }\n        if ( message.op === OP_REMOVE )\n        {\n          database.liveRemove( message.key );\n        }\n      }\n    }\n\n    channel.onpublish = handlePublish;\n\n    return {\n\n      channel: channel,\n      pubsub: pubsub,\n\n      save: function(model, data)\n      {\n        if ( !Neuro.forceOffline )\n        {\n          channel.publish(\n          {\n            op: OP_SAVE,\n            key: model.$key(),\n            model: data\n          });\n        }\n      },\n\n      remove: function(model)\n      {\n        if ( !Neuro.forceOffline )\n        {\n          channel.publish(\n          {\n            op: OP_REMOVE,\n            key: model.$key()\n          });\n        }\n      }\n\n    };\n  };\n\n  return LiveFactory;\n\n})();"],"sourceRoot":"/source/"}